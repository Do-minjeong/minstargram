<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="mj.project.mapper.SubMapper">
	<!-- 좋아요 기능 -->
	<insert id="likeOn">
		INSERT INTO post_likes(p_likes_no, post_no, member_no)
		VALUES (p_likes_no_seq.NEXTVAL, #{post_no}, #{member_no})
	</insert>

	<delete id="likeOff">
		DELETE FROM post_likes 
		WHERE post_no = #{post_no} AND member_no = #{member_no}
	</delete>

	<select id="likeCount" resultType="Integer">
		SELECT COUNT(*)
		FROM post_likes
		WHERE post_no = #{post_no}
	</select>
	
	<!-- 북마크 기능 -->
	<insert id="bookmarkOn">
		INSERT INTO post_bookmarks(p_bookmark_no, member_no, post_no)
		VALUES (p_bookmark_no_seq.NEXTVAL, #{member_no}, #{post_no})
	</insert>

	<delete id="bookmarkOff">
		DELETE FROM post_bookmarks
		WHERE post_no = #{post_no} AND member_no = #{member_no}
	</delete>

	<insert id="replyInsert" >
		<selectKey keyProperty="reply_no" resultType="int" order="BEFORE">
			SELECT reply_no_seq.NEXTVAL	FROM dual
		</selectKey>
		INSERT INTO replys(reply_no, post_no, member_no, r_contents)
		VALUES (#{reply_no}, #{post_no}, #{member_no}, #{r_contents})
	</insert>
	
	<insert id="rpLikeOn">
		INSERT INTO reply_likes(r_likes_no, reply_no, member_no)
		VALUES (r_likes_no_seq.NEXTVAL, #{reply_no}, #{member_no} )
	</insert>
	
	<delete id="rpLikeOff">
		DELETE FROM reply_likes
		WHERE reply_no = #{reply_no} AND member_no = #{member_no}
	</delete>
	
	<insert id="followOn">
		INSERT INTO follow_relationship(follow_no, member_no, tg_member_no)
		VALUES (follow_no_seq.NEXTVAL, #{member_no}, #{tg_no})
	</insert>
	<delete id="followOff">
		DELETE FROM follow_relationship
		WHERE member_no = #{member_no} AND tg_member_no = #{tg_no}
	</delete>
	
	
  </mapper>